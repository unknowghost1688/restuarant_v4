<html>
<head>

    <!-- jQuery and jQuery Mobile -->
    <script src="lib/jquery-1.9.1.min.js"></script>
    <script src="lib/jquery.mobile-1.3.1.min.js"></script>
    <link rel="stylesheet" href="css/jquery.mobile-1.3.1.min.css">

    <!-- Golf style and jQuery -->
    <link rel="stylesheet" href="css/golfStyle.css">
    <script type="text/javascript" src="phonegap.js"></script>
    <script type="text/javascript" src="js/PushNotification.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript">
        app.initialize();
    </script>
    <script type="text/javascript" src="slider_js/jssor.core.js"></script>
    <script type="text/javascript" src="slider_js/jssor.utils.js"></script>
    <script type="text/javascript" src="slider_js/jssor.slider.js"></script>
    <title></title>
</head>
<body>

    <div data-role="page" id="page1">
        
        <br /><br />
            <div class="ui-login-content">
                <br />
                <div class="ui-content">
                    <div style="text-align: center;">
                        <img class="logo" src="images/logo.png">
                    </div>
                    <br />
                    <br />
                    <input id="username" type="text" data-clear-btn="true" placeholder="Username">
                    <input id="password" type="password" data-clear-btn="true" placeholder="Password">
                    <select data-native-menu="false" id="OutletCode" name="OutletCode">
                        <option value="BBQ">BBQ - 烧烤</option>
                        <option value="BHC">Blue Lagoon -  蓝湖餐厅</option>
                        <option value="BQT">Banquet - 宴会</option>
                        <option value="CIG">CIGAR BAR - 雪茄吧</option>
                        <option value="GDG">Green Dragon - 青龙</option>
                        <option value="JHG">Jin Hua Ge - 金华阁</option>
                        <option value="lbm">Zero Department -零部门</option>
                        <option value="OBJ">Old Beijing - 老北京</option>
                        <option value="RMS">Room Service - 送餐</option>
                        <option value="SAN">Stream - 山水餐厅</option>
                        <option value="SPR">Sport Bar - 云动酒吧</option>
                        <option value="VIP">VIP Lounge - VIP 酒廊</option>
                        <option value="YLB">Sports &amp; Rrcreation-康体娱乐</option>
                    </select>
                    <select data-native-menu="false" id="StationCode" name="StationCode">
                        <option value="BBQ1">BBQ1</option>
                        <option value="BBQ2">BBQ2</option>
                    </select>
                    <a id="login" class="btnClick" data-role="button" data-transition="flip" data-theme="g">Login
                    </a>
                </div>
                <br />
            </div>
    </div>
    <div class="app">
        <div id="deviceready" class="blink">
            <p class="event listening"></p>
            <p class="event received"></p>
        </div>
    </div>

</body>
</html>
<script type="text/javascript">
    $(document).ready(function () {
        $("#login").click(function () {
            $.mobile.navigate("main_page.html");
        });
    });

    /* var URL_API = "http://localhost:3998";

    $(document).ready(function () {

        if (localStorage.getItem("UserName") != undefined && localStorage.getItem("Token") != undefined) {

          //  $.mobile.navigate("booking_menu.html");

            $.ajaxSetup({
                headers: {
                    "Authorization": "Bearer " + localStorage.getItem("Token")
                }
            });


        }

        $("#login").click(function () {
            login($("#username").val(), $("#password").val());
        });


    });


    function login(username, password) {
        $.ajax({
            type: "POST",
            url: URL_API + "/token",
            async: false,
            contentType: "application/x-www-form-urlencoded",
            data: "grant_type=password&username=" + username + "&password=" + password
        })
       .done(function (data) {
           var isLogin = authenticate(data);

           if (isLogin) {
               $.mobile.navigate("booking_menu.html");

               localStorage.setItem("Token", data.access_token);
               localStorage.setItem("UserName", data.userName);

           } else {
               alert("invalid login");
           }
       }).fail(function () {
           alert("invalid login");

       });
    }


    function getDeviceID() {
        return localStorage.getItem("DeviceKey");;
    }

    function authenticate(msg) {

        var IsAuthenticated = false;

        var token = {
            "DeviceKey": getDeviceID(),
            "Token": msg.access_token,
            "TokenExpiryDate": msg.expires_in,
            "UserName": msg.userName
        };


        $.ajax({
            type: "POST",
            url: URL_API + "/api/User/Authenticate",
            contentType: "application/json",
            async: false,
            data: JSON.stringify(token),
            headers: {
                "Authorization": "Bearer " + msg.access_token
            }
        }).done(function (data) {

            var msg = JSON.parse(data);

            localStorage.setItem("ICNo", msg.ICNo);
            localStorage.setItem("Email", msg.Email);
            IsAuthenticated = true;

        }).fail(function () {
            IsAuthenticated = false;
        });

        return IsAuthenticated;
    } */
</script>

